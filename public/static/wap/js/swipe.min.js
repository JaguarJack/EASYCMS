/*
* Swipe 2.0
*
* Brad Birdsall
* Copyright 2013, MIT License
* 20131105 lijun 
*/

function Swipe(a,b){"use strict";function l(){g=f.children,h=Array(g.length),i=a.getBoundingClientRect().width||a.offsetWidth,f.style.width=g.length*i+"px";for(var b=g.length;b--;){var c=g[b];c.style.width=i+"px",c.setAttribute("data-index",b),e.transitions&&(c.style.left=b*-i+"px",p(b,j>b?-i:b>j?i:0,0))}e.transitions||(f.style.left=j*-i+"px"),a.style.visibility="visible"}function m(){j?o(j-1):b.continuous&&o(g.length-1)}function n(){g.length-1>j?o(j+1):b.continuous&&o(0)}function o(a,c){if(j!=a){if(e.transitions){for(var f=Math.abs(j-a)-1,h=Math.abs(j-a)/(j-a);f--;)p((a>j?a:j)-f-1,i*h,0);p(j,i*h,c||k),p(a,0,c||k)}else r(j*-i,a*-i,c||k);j=a,d(b.callback&&b.callback(j,g[j]))}}function p(a,b,c){q(a,b,c),h[a]=b}function q(a,b,c){var d=g[a],e=d&&d.style;e&&(e.webkitTransitionDuration=e.MozTransitionDuration=e.msTransitionDuration=e.OTransitionDuration=e.transitionDuration=c+"ms",e.webkitTransform="translate("+b+"px,0)"+"translateZ(0)",e.msTransform=e.MozTransform=e.OTransform="translateX("+b+"px)")}function r(a,c,d){if(!d)return f.style.left=c+"px",void 0;var e=+new Date,h=setInterval(function(){var i=+new Date-e;return i>d?(f.style.left=c+"px",s&&u(),b.transitionEnd&&b.transitionEnd.call(event,j,g[j]),clearInterval(h),void 0):(f.style.left=(c-a)*(Math.floor(100*(i/d))/100)+a+"px",void 0)},4)}function u(){t=setTimeout(n,s)}function v(){s=0,clearTimeout(t)}var c=function(){},d=function(a){setTimeout(a||c,0)},e={addEventListener:!!window.addEventListener,touch:"ontouchstart" in window||window.DocumentTouch&&document instanceof DocumentTouch,transitions:function(a){var b=["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"];for(var c in b)if(void 0!==a.style[b[c]])return!0;return!1}(document.createElement("swipe"))};if(a){var g,h,i,f=a.children[0];b=b||{};var t,y,j=parseInt(b.startSlide,10)||0,k=b.speed||300,s=b.auto||0,w={},x={},z={handleEvent:function(a){switch(a.type){case "touchstart":this.start(a);break;case "touchmove":this.move(a);break;case "touchend":d(this.end(a));case "webkitTransitionEnd":case "msTransitionEnd":case "oTransitionEnd":case "otransitionend":case "transitionend":d(this.transitionEnd(a));break;case "resize":d(l.call())}b.stopPropagation&&a.stopPropagation()},start:function(a){var b=a.touches[0];w={x:b.pageX,y:b.pageY,time:+new Date},y=void 0,x={},f.addEventListener("touchmove",this,!1),f.addEventListener("touchend",this,!1)},move:function(a){if(!(a.touches.length>1||a.scale&&1!==a.scale)){b.disableScroll&&a.preventDefault();var c=a.touches[0];x={x:c.pageX-w.x,y:c.pageY-w.y},y===void 0&&(y=!!(y||Math.abs(x.x)<Math.abs(x.y))),y||(a.preventDefault(),v(),x.x=x.x/(!j&&x.x>0||j==g.length-1&&0>x.x?Math.abs(x.x)/i+1:1),q(j-1,x.x+h[j-1],0),q(j,x.x+h[j],0),q(j+1,x.x+h[j+1],0))}},end:function(){var c=+new Date-w.time,d=250>Number(c)&&Math.abs(x.x)>20||Math.abs(x.x)>i/2,e=!j&&x.x>0||j==g.length-1&&0>x.x,l=0>x.x;y||(d&&!e?(l?(p(j-1,-i,0),p(j,h[j]-i,k),p(j+1,h[j+1]-i,k),j+=1):(p(j+1,i,0),p(j,h[j]+i,k),p(j-1,h[j-1]+i,k),j+=-1),b.callback&&b.callback(j,g[j])):(p(j-1,-i,k),p(j,0,k),p(j+1,i,k))),f.removeEventListener("touchmove",z,!1),f.removeEventListener("touchend",z,!1);s=b.auto;},transitionEnd:function(a){parseInt(a.target.getAttribute("data-index"),10)==j&&(s&&u(),b.transitionEnd&&b.transitionEnd.call(a,j,g[j]))}};return l(),s&&u(),e.addEventListener?(e.touch&&f.addEventListener("touchstart",z,!1),e.transitions&&(f.addEventListener("webkitTransitionEnd",z,!1),f.addEventListener("msTransitionEnd",z,!1),f.addEventListener("oTransitionEnd",z,!1),f.addEventListener("otransitionend",z,!1),f.addEventListener("transitionend",z,!1)),window.addEventListener("resize",z,!1)):window.onresize=function(){l()},{setup:function(){l()},slide:function(a,b){o(a,b)},prev:function(){v(),m()},next:function(){v(),n()},getPos:function(){return j},kill:function(){v(),f.style.width="auto",f.style.left=0;for(var a=g.length;a--;){var b=g[a];b.style.width="100%",b.style.left=0,e.transitions&&q(a,0,0)}e.addEventListener?(f.removeEventListener("touchstart",z,!1),f.removeEventListener("webkitTransitionEnd",z,!1),f.removeEventListener("msTransitionEnd",z,!1),f.removeEventListener("oTransitionEnd",z,!1),f.removeEventListener("otransitionend",z,!1),f.removeEventListener("transitionend",z,!1),window.removeEventListener("resize",z,!1)):window.onresize=null}}}}(window.jQuery||window.Zepto)&&function(a){a.fn.Swipe=function(b){return this.each(function(){a(this).data("Swipe",new Swipe(a(this)[0],b))})}}(window.jQuery||window.Zepto);